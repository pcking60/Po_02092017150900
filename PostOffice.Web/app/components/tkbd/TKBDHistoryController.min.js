"use strict";angular.module("postoffice.tkbd").controller("TKBDHistoryController",["$scope","apiService","notificationService","$ngBootbox","$filter","$state","authService","$stateParams",function(n,t,i,r,u,f,e,o){function h(){t.get("/api/district/getallparents",null,function(t){n.tkbd.districts=t.data},function(){i.displayError("Không tải được danh sách huyện.")})}function s(){t.get("/api/po/getbydistrictid/ "+o.id,null,function(t){n.tkbd.pos=t.data},function(){i.displayError("Không tải được danh sách đơn vị.")})}function c(){t.get("/api/applicationUser/getuserbypoid/"+o.id,null,function(t){n.tkbd.users=t.data},function(){i.displayError("Không tải được danh sách nhân viên.")})}function l(){getTkbds()}function a(){var r=n.tkbd.date.startDate.format("MM-DD-YYYY"),u=n.tkbd.date.endDate.format("MM-DD-YYYY"),f={params:{fromDate:r,toDate:u,districtId:n.tkbd.districtId||0,posId:n.tkbd.posId||0,userId:n.tkbd.userId||"",serviceId:n.tkbd.serviceId||0,page:page,pageSize:20}};t.get("api/tkbd/gethistorybycondition",f,function(t){t.data.TotalCount==0&&i.displayWarning("Không tìm thấy bản ghi nào!");n.tkbds=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;n.loading=!1},function(){n.loading=!1;console.log("Load list TKBD History failed")})}n.page=0;n.pagesCount=0;n.tkbds=[];n.show=!1;n.keyword="";n.search=l;n.loading=!0;n.tkbd={functionId:0,date:{startDate:null,endDate:null},districts:[],pos:[],users:[],districtId:0,posId:0,userId:"",serviceId:0};o.id=0;n.isManager=e.haveRole("Manager");n.isAdmin=e.haveRole("Administrator");n.isManager?(o.id=e.authentication.userName,t.get("/api/applicationUser/userinfo",null,function(t){o.id=t.data.POID;n.tkbd.districtId=t.data.POID;s()},function(){i.displayError("Không tải được danh sách huyện/ thành phố.")})):n.isAdmin&&h();n.getDistricts=h;n.updatePos=function(t){t!=0&&t!=null?(o.id=t,s()):(n.tkbd.pos=[],n.tkbd.posId=0)};n.getPos=s;n.updateUser=function(t){t!=0&&t!=null?(o.id=t,c()):(n.tkbd.users=[],n.tkbd.userId=0)};n.getListUser=c;n.getTkbdHistory=a;n.getTKBD1Day=function(r){r=r||0;var u={params:{page:r,pageSize:20}};t.get("/api/tkbd/gettkbd1day",u,function(t){t.data.TotalCount==0&&i.displayWarning("Không tìm thấy bản ghi nào!");n.tkbds=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;n.loading=!1},function(){n.loading=!1;console.log("Load list TKBD History failed")})};n.getTKBD7Day=function(r){r=r||0;var u={params:{page:r,pageSize:20}};t.get("/api/tkbd/gettkbd7day",u,function(t){t.data.TotalCount==0&&i.displayWarning("Không tìm thấy bản ghi nào!");n.tkbds=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;n.loading=!1},function(){n.loading=!1;console.log("Load list TKBD History failed")})};n.getTKBD30Day=function(r){r=r||0;var u={params:{page:r,pageSize:20}};t.get("/api/tkbd/gettkbd30day",u,function(t){t.data.TotalCount==0&&i.displayWarning("Không tìm thấy bản ghi nào!");n.tkbds=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;n.loading=!1},function(){n.loading=!1;console.log("Load list TKBD History failed")})}}]);